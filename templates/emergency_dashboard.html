{% extends "base.html" %}

{% block title %}Emergency Dashboard - meowCHAT{% endblock %}

{% block content %}
<div class="dashboard-content">
    <div class="dashboard-inner">
        <div class="card">
            <div class="card-header">
                <h3>ðŸš¨ Emergency Dashboard</h3>
                <p>This is a fallback page to ensure the app works while we fix the static file issues.</p>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h4>Diagnostic Information</h4>
                    <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
                    <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
                    <p><strong>Online Status:</strong> <span id="onlineStatus"></span></p>
                    <p><strong>Static Files Status:</strong> <span id="staticFilesStatus">Checking...</span></p>
                </div>
                
                <div class="mt-4">
                    <h4>Quick Actions</h4>
                    <div class="row">
                        <div class="col-6">
                            <a href="/messaging" class="btn btn-primary w-100 mb-2">Messages</a>
                        </div>
                        <div class="col-6">
                            <a href="/notifications" class="btn btn-secondary w-100 mb-2">Notifications</a>
                        </div>
                        <div class="col-6">
                            <a href="/create-post" class="btn btn-success w-100 mb-2">Create Post</a>
                        </div>
                        <div class="col-6">
                            <a href="/profile" class="btn btn-info w-100 mb-2">Profile</a>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h4>Debug Links</h4>
                    <ul>
                        <li><a href="/static-test" target="_blank">Static File Test</a></li>
                        <li><a href="/pwa-debug" target="_blank">PWA Debug</a></li>
                        <li><a href="/debug-static/main.css" target="_blank">CSS File Debug</a></li>
                        <li><a href="/static/css/main.css" target="_blank">Direct CSS Link</a></li>
                    </ul>
                </div>
                
                <div class="mt-4">
                    <h4>Manual Tests</h4>
                    <p>Please check the browser console (F12) for diagnostic information.</p>
                    <button onclick="runDiagnostics()" class="btn btn-warning">Run Diagnostics</button>
                    <button onclick="clearCache()" class="btn btn-danger">Clear Cache</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Emergency dashboard functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Display basic info
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('onlineStatus').textContent = navigator.onLine ? 'Online' : 'Offline';
        
        // Test static files
        testStaticFiles();
    });
    
    async function testStaticFiles() {
        const files = [
            '/static/css/main.css',
            '/static/js/pwa-utils.js',
            '/manifest.json',
            '/sw.js'
        ];
        
        let results = [];
        
        for (const file of files) {
            try {
                const response = await fetch(file);
                results.push({
                    file: file,
                    status: response.status,
                    size: response.headers.get('content-length') || 'unknown',
                    ok: response.ok
                });
            } catch (error) {
                results.push({
                    file: file,
                    error: error.message
                });
            }
        }
        
        const statusElement = document.getElementById('staticFilesStatus');
        const failedFiles = results.filter(r => !r.ok || r.error);
        
        if (failedFiles.length === 0) {
            statusElement.textContent = 'âœ… All files loading correctly';
            statusElement.style.color = '#28a745';
        } else {
            statusElement.textContent = `âŒ ${failedFiles.length} files failed to load`;
            statusElement.style.color = '#dc3545';
        }
        
        console.log('Static file test results:', results);
    }
    
    function runDiagnostics() {
        console.log('=== MANUAL DIAGNOSTIC RUN ===');
        testStaticFiles();
        
        // Test DOM elements
        const elements = ['body', '.main-content-wrapper', '.navbar-meow', '.bottom-nav'];
        elements.forEach(selector => {
            const element = document.querySelector(selector);
            if (element) {
                const style = window.getComputedStyle(element);
                console.log(`${selector}:`, {
                    display: style.display,
                    visibility: style.visibility,
                    opacity: style.opacity,
                    backgroundColor: style.backgroundColor
                });
            } else {
                console.log(`${selector}: NOT FOUND`);
            }
        });
        
        alert('Diagnostics completed! Check the console (F12) for results.');
    }
    
    function clearCache() {
        if ('caches' in window) {
            caches.keys().then(cacheNames => {
                return Promise.all(
                    cacheNames.map(cacheName => {
                        console.log('Deleting cache:', cacheName);
                        return caches.delete(cacheName);
                    })
                );
            }).then(() => {
                alert('Cache cleared successfully! Please refresh the page.');
            }).catch(error => {
                console.error('Error clearing cache:', error);
                alert('Error clearing cache: ' + error.message);
            });
        } else {
            alert('Cache API not supported');
        }
    }
</script>
{% endblock %}
